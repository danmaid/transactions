<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>会計帳簿</title>
    <style>
      table th,
      table td {
        border-right: 1px solid;
        border-bottom: 1px solid;
      }
      table caption {
        border-bottom: 1px solid;
      }
      #receipts img {
        max-width: 100px;
        max-height: 100px;
      }
    </style>
    <script type="module" src="/src/dm-upload-receipt-button.ts"></script>
  </head>
  <body>
    <dm-upload-receipt-button></dm-upload-receipt-button>

    <div>
      <button id="get">GET /receipts</button>
      <div id="receipts"></div>
      <script>
        document.getElementById('get').addEventListener('click', async (ev) => {
          const res = await fetch('/', { headers: { Accept: 'application/json' } })
          const items = await res.json()
          const receipts = document.getElementById('receipts')
          receipts.innerHTML = ''
          for (const item of items) {
            const { 'content-type': type, id } = item
            if (typeof type !== 'string' || !type.startsWith('image')) continue
            const img = document.createElement('img')
            img.src = id
            img.onclick = (ev) => {
              const form = document.forms.namedItem('payment')
              form.elements.namedItem('id').value = item.id
              form.elements.namedItem('date').value = item.date
              form.elements.namedItem('partner').value = item.partner
              form.elements.namedItem('item').value = item.item
              form.elements.namedItem('price').value = item.price
              form.elements.namedItem('method').value = item.method
            }
            receipts.append(img)
          }
        })
      </script>
    </div>

    <div>
      <form id="payment">
        <label>ID<input id="id" /></label>
        <label>日時<input name="date" /></label>
        <label>相手<input name="partner" /></label>
        <label>品名<input name="item" /></label>
        <label>価格<input name="price" /></label>
        <label>支払方法<input name="method" /></label>
        <button id="submit">送信</button>
      </form>
      <script>
        const form = document.forms.namedItem('payment')
        console.log(form.elements)
        console.log(JSON.stringify(form.elements))
        form.onsubmit = (ev) => {
          console.log(ev)
          ev.preventDefault()
          const inputs = Array.from(form.elements).filter((v) => v.name)
          const values = Object.fromEntries(inputs.map((v) => [v.name, v.value]))
          const id = form.elements.id.value
          console.log(id, values)
          fetch(id, { method: 'PUT', body: JSON.stringify(values), headers: { 'Content-Type': 'application/json' } })
        }
      </script>
    </div>

    <div style="display: flex; align-items: baseline; justify-content: space-around">
      <label>start: <input type="date" /></label>
      <label>end:<input type="date" /></label>
      <fieldset>
        <legend>group by</legend>
        <label><input type="checkbox" />年</label>
        <label><input type="checkbox" />月</label>
        <label><input type="checkbox" />日</label>
      </fieldset>
    </div>

    <div>GET /?date=true&price=true => Payment[]</div>
    <div>GET /payments => Payment[]</div>

    <div>
      <button>upload receipt</button>
      POST /receipts File (Content-Type: image/png etc...)
    </div>

    <div>未おこしレシートリスト GET /receipts?price=false</div>
    <div>レシート文字起こし GET /{id} -> PUT /payments/{id} Payment -> PATCH /{id} Payment</div>

    <div style="display: flex; justify-content: space-around">
      <table>
        <caption>
          単式
        </caption>
        <thead>
          <tr>
            <th>収入</th>
            <th>支出</th>
            <th>摘要</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td></td>
            <td>120,000</td>
            <td>パソコン購入</td>
          </tr>
        </tbody>
      </table>
      <table>
        <caption>
          複式
        </caption>
        <thead>
          <tr>
            <th colspan="2">借方</th>
            <th colspan="2">貸方</th>
            <th rowspan="2">摘要</th>
          </tr>
          <tr>
            <th>勘定科目</th>
            <th>金額</th>
            <th>勘定科目</th>
            <th>金額</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>工具器具備品</td>
            <td>120,000</td>
            <td>現金</td>
            <td>120,000</td>
            <td>パソコン購入</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div>
      <table>
        <caption>
          貸借対照表
        </caption>
        <thead>
          <th>勘定科目</th>
          <th>金額</th>
          <th>勘定科目</th>
          <th>金額</th>
        </thead>
        <tbody>
          <tr>
            <td colspan="2">資産の部</td>
            <td colspan="2">負債の部</td>
          </tr>
          <tr>
            <td colspan="2"></td>
            <td colspan="2">純資産の部</td>
          </tr>
          <tr>
            <td>資産合計</td>
            <td>24,100</td>
            <td>負債・純資産合計</td>
            <td>24,100</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- <div id="app"></div>
    <script type="module" src="/src/main.ts"></script> -->
  </body>
</html>
